{"ast":null,"code":"import { CONNECT_TO_SOCKET } from './actionTypes';\nimport socketIOClient from \"socket.io-client\";\nimport crypto from 'crypto';\nexport default function connectToSocket() {\n  return dispatch => {\n    const socket = socketIOClient(\"localhost:8000\");\n    const data = {\n      id: localStorage.getItem('id'),\n      numberRoom: localStorage.getItem('id')\n    };\n    console.log(\"socket\", socket.id);\n    socket.on(\"connect\", socket => {});\n    socket.on(\"DH_response\", dataRes => {\n      console.log(\"qwqqqqqqqqqqqqqqqqqqqqqqq\", dataRes);\n      let client = crypto.createDiffieHellman(dataRes.serverPrime, dataRes.serverGenerator);\n      console.log(dataRes.serverPrime);\n      console.log(dataRes.serverGenerator);\n      console.log(dataRes.serverPublicKey);\n      client.generateKeys();\n      const buf = Buffer.from(dataRes.serverPublicKey);\n      console.log(buf);\n      const bufStr = dataRes.serverPublicKey;\n      const pubCliKey = client.getPublicKey(); //console.log(\"bufStr\", bufStr)\n\n      let secret = client.computeSecret(buf);\n      console.log(\"secretsecretsecret\", secret);\n      let DHEndData = {\n        id: data.id,\n        pubCliKey: pubCliKey\n      };\n      socket.emit(\"DH_end\", DHEndData);\n    });\n    socket.emit('join', {\n      numberRoom: data.numberRoom\n    });\n    socket.emit(\"DH_begin\", data);\n    console.log(\"CONNECT SOCKET\", socket);\n    dispatch(connected(socket));\n  };\n}\nexport function connected(socket) {\n  return {\n    type: CONNECT_TO_SOCKET,\n    socket\n  };\n}","map":{"version":3,"sources":["/home/gleban/WORKS/messnger_project/client/src/store/actions/connectToSocket.js"],"names":["CONNECT_TO_SOCKET","socketIOClient","crypto","connectToSocket","dispatch","socket","data","id","localStorage","getItem","numberRoom","console","log","on","dataRes","client","createDiffieHellman","serverPrime","serverGenerator","serverPublicKey","generateKeys","buf","Buffer","from","bufStr","pubCliKey","getPublicKey","secret","computeSecret","DHEndData","emit","connected","type"],"mappings":"AAAA,SAASA,iBAAT,QAAkC,eAAlC;AAEA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAGA,eAAe,SAASC,eAAT,GAA2B;AACtC,SAAOC,QAAQ,IAAI;AACf,UAAMC,MAAM,GAAGJ,cAAc,CAAC,gBAAD,CAA7B;AACA,UAAMK,IAAI,GAAE;AACRC,MAAAA,EAAE,EAAEC,YAAY,CAACC,OAAb,CAAqB,IAArB,CADI;AAERC,MAAAA,UAAU,EAAEF,YAAY,CAACC,OAAb,CAAqB,IAArB;AAFJ,KAAZ;AAIAE,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBP,MAAM,CAACE,EAA7B;AAEAF,IAAAA,MAAM,CAACQ,EAAP,CAAU,SAAV,EAAsBR,MAAD,IAAY,CAChC,CADD;AAIAA,IAAAA,MAAM,CAACQ,EAAP,CAAU,aAAV,EAAyBC,OAAO,IAAI;AAChCH,MAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAyCE,OAAzC;AACA,UAAIC,MAAM,GAAGb,MAAM,CAACc,mBAAP,CAA2BF,OAAO,CAACG,WAAnC,EAAgDH,OAAO,CAACI,eAAxD,CAAb;AACAP,MAAAA,OAAO,CAACC,GAAR,CAAYE,OAAO,CAACG,WAApB;AACAN,MAAAA,OAAO,CAACC,GAAR,CAAYE,OAAO,CAACI,eAApB;AACAP,MAAAA,OAAO,CAACC,GAAR,CAAYE,OAAO,CAACK,eAApB;AACAJ,MAAAA,MAAM,CAACK,YAAP;AACA,YAAMC,GAAG,GAAGC,MAAM,CAACC,IAAP,CAAYT,OAAO,CAACK,eAApB,CAAZ;AACAR,MAAAA,OAAO,CAACC,GAAR,CAAYS,GAAZ;AACA,YAAMG,MAAM,GAAGV,OAAO,CAACK,eAAvB;AAEA,YAAMM,SAAS,GAAGV,MAAM,CAACW,YAAP,EAAlB,CAXgC,CAYhC;;AAEA,UAAIC,MAAM,GAAGZ,MAAM,CAACa,aAAP,CAAqBP,GAArB,CAAb;AACAV,MAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCe,MAAlC;AAEA,UAAIE,SAAS,GAAG;AACZtB,QAAAA,EAAE,EAAED,IAAI,CAACC,EADG;AAEZkB,QAAAA,SAAS,EAAEA;AAFC,OAAhB;AAIApB,MAAAA,MAAM,CAACyB,IAAP,CAAY,QAAZ,EAAsBD,SAAtB;AACH,KAtBD;AAuBAxB,IAAAA,MAAM,CAACyB,IAAP,CAAY,MAAZ,EAAoB;AAACpB,MAAAA,UAAU,EAAEJ,IAAI,CAACI;AAAlB,KAApB;AACAL,IAAAA,MAAM,CAACyB,IAAP,CAAY,UAAZ,EAAwBxB,IAAxB;AAIAK,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BP,MAA9B;AACAD,IAAAA,QAAQ,CAAC2B,SAAS,CAAC1B,MAAD,CAAV,CAAR;AACH,GA1CD;AA4CH;AAED,OAAO,SAAS0B,SAAT,CAAmB1B,MAAnB,EAA2B;AAC9B,SAAO;AACH2B,IAAAA,IAAI,EAAEhC,iBADH;AAEHK,IAAAA;AAFG,GAAP;AAIH","sourcesContent":["import { CONNECT_TO_SOCKET } from './actionTypes'\n\nimport socketIOClient from \"socket.io-client\";\nimport crypto from 'crypto'\n\n\nexport default function connectToSocket() {\n    return dispatch => {\n        const socket = socketIOClient(\"localhost:8000\");\n        const data ={ \n            id: localStorage.getItem('id'),\n            numberRoom: localStorage.getItem('id')\n        }\n        console.log(\"socket\", socket.id)\n        \n        socket.on(\"connect\", (socket) => {\n        });\n       \n        \n        socket.on(\"DH_response\", dataRes => {\n            console.log(\"qwqqqqqqqqqqqqqqqqqqqqqqq\", dataRes)\n            let client = crypto.createDiffieHellman(dataRes.serverPrime, dataRes.serverGenerator) \n            console.log(dataRes.serverPrime)\n            console.log(dataRes.serverGenerator)\n            console.log(dataRes.serverPublicKey)\n            client.generateKeys()\n            const buf = Buffer.from(dataRes.serverPublicKey);\n            console.log(buf);\n            const bufStr = dataRes.serverPublicKey\n\n            const pubCliKey = client.getPublicKey();\n            //console.log(\"bufStr\", bufStr)\n            \n            let secret = client.computeSecret(buf) \n            console.log(\"secretsecretsecret\", secret)\n\n            let DHEndData = {\n                id: data.id,\n                pubCliKey: pubCliKey\n            }\n            socket.emit(\"DH_end\", DHEndData);\n        })\n        socket.emit('join', {numberRoom: data.numberRoom});\n        socket.emit(\"DH_begin\", data);\n       \n\n        \n        console.log(\"CONNECT SOCKET\", socket)\n        dispatch(connected(socket))\n    }\n    \n}\n\nexport function connected(socket) {\n    return {\n        type: CONNECT_TO_SOCKET,\n        socket\n    }\n}"]},"metadata":{},"sourceType":"module"}