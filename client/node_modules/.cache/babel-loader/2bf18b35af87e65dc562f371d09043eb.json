{"ast":null,"code":"import axios from 'axios';\nimport CryptoJS from 'crypto-js';\nimport { AUTH_SUCCESS, AUTH_LOGOUT } from './actionTypes';\nexport function auth(email, password, isLogin) {\n  return async dispatch => {\n    const authData = {\n      email,\n      password\n    };\n    const secret = localStorage.getItem(\"secret\");\n    var ciphertext = CryptoJS.AES.encrypt(email, secret).toString(); // Decrypt\n\n    var bytes = CryptoJS.AES.decrypt(ciphertext, secret);\n    var originalText = bytes.toString(CryptoJS.enc.Utf8);\n    console.log(originalText);\n    let url = 'http://localhost:8888/registration';\n\n    if (isLogin) {\n      console.log(\"isLogin\");\n      url = 'http://localhost:8888/auth';\n    }\n\n    let body = JSON.stringify(authData);\n    axios({\n      method: 'post',\n      url: url,\n      data: body\n    }).then(response => {\n      console.log(response);\n      localStorage.setItem('userId', response.data.userId);\n      localStorage.setItem('email', response.data.email);\n      localStorage.setItem('token', response.data.token);\n      let expiresIn = response.data.dateOfCreation;\n      const expirationDate = new Date(new Date().getTime() + expiresIn * 1000);\n      dispatch(authSuccess(response.data.token));\n      dispatch(authLogout(response.data.dateOfCreation));\n    }).catch(function (error) {\n      console.log(error);\n    });\n  };\n}\nexport function authLogout() {\n  return dispatch => {\n    setTimeout(() => {\n      dispatch(logout());\n    }, 300000);\n  };\n}\nexport function logout() {\n  console.log(\"logout\");\n  localStorage.setItem('userId', null);\n  localStorage.setItem('email', null);\n  localStorage.setItem('token', null);\n  return {\n    type: AUTH_LOGOUT\n  };\n}\nexport function autoLogin() {\n  return dispatch => {\n    const token = localStorage.getItem('token');\n\n    if (!token) {\n      dispatch(logout());\n    } else {\n      dispatch(authSuccess(token));\n    }\n  };\n}\nexport function authSuccess(token) {\n  console.log(\"authSuc\");\n  return {\n    type: AUTH_SUCCESS,\n    token\n  };\n}","map":{"version":3,"sources":["/home/gleban/WORKS/messnger_project/client/src/store/actions/auth.js"],"names":["axios","CryptoJS","AUTH_SUCCESS","AUTH_LOGOUT","auth","email","password","isLogin","dispatch","authData","secret","localStorage","getItem","ciphertext","AES","encrypt","toString","bytes","decrypt","originalText","enc","Utf8","console","log","url","body","JSON","stringify","method","data","then","response","setItem","userId","token","expiresIn","dateOfCreation","expirationDate","Date","getTime","authSuccess","authLogout","catch","error","setTimeout","logout","type","autoLogin"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,SAASC,YAAT,EAAuBC,WAAvB,QAA0C,eAA1C;AAEA,OAAO,SAASC,IAAT,CAAcC,KAAd,EAAqBC,QAArB,EAA+BC,OAA/B,EAAwC;AAC3C,SAAO,MAAMC,QAAN,IAAkB;AACrB,UAAMC,QAAQ,GAAG;AACbJ,MAAAA,KADa;AACNC,MAAAA;AADM,KAAjB;AAIA,UAAMI,MAAM,GAAGC,YAAY,CAACC,OAAb,CAAqB,QAArB,CAAf;AACA,QAAIC,UAAU,GAAGZ,QAAQ,CAACa,GAAT,CAAaC,OAAb,CAAqBV,KAArB,EAA4BK,MAA5B,EAAoCM,QAApC,EAAjB,CANqB,CAQrB;;AACA,QAAIC,KAAK,GAAIhB,QAAQ,CAACa,GAAT,CAAaI,OAAb,CAAqBL,UAArB,EAAiCH,MAAjC,CAAb;AACA,QAAIS,YAAY,GAAGF,KAAK,CAACD,QAAN,CAAef,QAAQ,CAACmB,GAAT,CAAaC,IAA5B,CAAnB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAYJ,YAAZ;AAEJ,QAAIK,GAAG,GAAG,oCAAV;;AAEA,QAAGjB,OAAH,EAAY;AACRe,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AAEAC,MAAAA,GAAG,GAAG,4BAAN;AACH;;AAKD,QAAIC,IAAI,GAAGC,IAAI,CAACC,SAAL,CAAelB,QAAf,CAAX;AAEAT,IAAAA,KAAK,CAAC;AACJ4B,MAAAA,MAAM,EAAE,MADJ;AAEJJ,MAAAA,GAAG,EAAEA,GAFD;AAGJK,MAAAA,IAAI,EAAEJ;AAHF,KAAD,CAAL,CAIGK,IAJH,CAISC,QAAD,IAAc;AAClBT,MAAAA,OAAO,CAACC,GAAR,CAAYQ,QAAZ;AACApB,MAAAA,YAAY,CAACqB,OAAb,CAAqB,QAArB,EAA+BD,QAAQ,CAACF,IAAT,CAAcI,MAA7C;AACAtB,MAAAA,YAAY,CAACqB,OAAb,CAAqB,OAArB,EAA8BD,QAAQ,CAACF,IAAT,CAAcxB,KAA5C;AACAM,MAAAA,YAAY,CAACqB,OAAb,CAAqB,OAArB,EAA8BD,QAAQ,CAACF,IAAT,CAAcK,KAA5C;AACA,UAAIC,SAAS,GAAGJ,QAAQ,CAACF,IAAT,CAAcO,cAA9B;AACA,YAAMC,cAAc,GAAG,IAAIC,IAAJ,CAAS,IAAIA,IAAJ,GAAWC,OAAX,KAAuBJ,SAAS,GAAG,IAA5C,CAAvB;AAEA3B,MAAAA,QAAQ,CAACgC,WAAW,CAACT,QAAQ,CAACF,IAAT,CAAcK,KAAf,CAAZ,CAAR;AACA1B,MAAAA,QAAQ,CAACiC,UAAU,CAACV,QAAQ,CAACF,IAAT,CAAcO,cAAf,CAAX,CAAR;AACH,KAdD,EAeCM,KAfD,CAeO,UAAUC,KAAV,EAAiB;AACpBrB,MAAAA,OAAO,CAACC,GAAR,CAAYoB,KAAZ;AACH,KAjBD;AAkBD,GA5CC;AA6CH;AACD,OAAO,SAASF,UAAT,GAAsB;AACzB,SAAOjC,QAAQ,IAAI;AACfoC,IAAAA,UAAU,CAAC,MAAM;AACbpC,MAAAA,QAAQ,CAACqC,MAAM,EAAP,CAAR;AACH,KAFS,EAEP,MAFO,CAAV;AAGH,GAJD;AAKH;AAED,OAAO,SAASA,MAAT,GAAkB;AACrBvB,EAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAZ,EAAAA,YAAY,CAACqB,OAAb,CAAqB,QAArB,EAA+B,IAA/B;AACArB,EAAAA,YAAY,CAACqB,OAAb,CAAqB,OAArB,EAA8B,IAA9B;AACArB,EAAAA,YAAY,CAACqB,OAAb,CAAqB,OAArB,EAA8B,IAA9B;AACA,SAAO;AACHc,IAAAA,IAAI,EAAE3C;AADH,GAAP;AAGH;AAED,OAAO,SAAS4C,SAAT,GAAqB;AACxB,SAAOvC,QAAQ,IAAI;AACf,UAAM0B,KAAK,GAAGvB,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAd;;AACA,QAAI,CAACsB,KAAL,EAAW;AACP1B,MAAAA,QAAQ,CAACqC,MAAM,EAAP,CAAR;AACH,KAFD,MAEO;AACHrC,MAAAA,QAAQ,CAACgC,WAAW,CAACN,KAAD,CAAZ,CAAR;AACH;AACJ,GAPD;AAQH;AAGD,OAAO,SAASM,WAAT,CAAqBN,KAArB,EAA4B;AAC/BZ,EAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACA,SAAO;AACHuB,IAAAA,IAAI,EAAE5C,YADH;AAEHgC,IAAAA;AAFG,GAAP;AAIH","sourcesContent":["import axios from 'axios'\nimport CryptoJS from 'crypto-js';\nimport { AUTH_SUCCESS, AUTH_LOGOUT } from './actionTypes'\n\nexport function auth(email, password, isLogin) {\n    return async dispatch => {\n        const authData = {\n            email, password\n        }\n          \n        const secret = localStorage.getItem(\"secret\");\n        var ciphertext = CryptoJS.AES.encrypt(email, secret).toString();\n \n        // Decrypt\n        var bytes  = CryptoJS.AES.decrypt(ciphertext, secret);\n        var originalText = bytes.toString(CryptoJS.enc.Utf8);\n        console.log(originalText)\n    \n    let url = 'http://localhost:8888/registration'\n\n    if(isLogin) {\n        console.log(\"isLogin\")\n\n        url = 'http://localhost:8888/auth'\n    }\n    \n\n\n\n    let body = JSON.stringify(authData);\n    \n    axios({\n      method: 'post',\n      url: url,\n      data: body,\n    }).then((response) => {\n        console.log(response);\n        localStorage.setItem('userId', response.data.userId)\n        localStorage.setItem('email', response.data.email)\n        localStorage.setItem('token', response.data.token)\n        let expiresIn = response.data.dateOfCreation;\n        const expirationDate = new Date(new Date().getTime() + expiresIn * 1000)  \n\n        dispatch(authSuccess(response.data.token))\n        dispatch(authLogout(response.data.dateOfCreation))\n    })\n    .catch(function (error) {\n        console.log(error);\n    });\n  }\n}\nexport function authLogout() {\n    return dispatch => {\n        setTimeout(() => {\n            dispatch(logout())\n        }, 300000)\n    }\n}\n\nexport function logout() {\n    console.log(\"logout\")\n    localStorage.setItem('userId', null)\n    localStorage.setItem('email', null)\n    localStorage.setItem('token', null)\n    return {\n        type: AUTH_LOGOUT \n    }\n}\n\nexport function autoLogin() {\n    return dispatch => {\n        const token = localStorage.getItem('token')\n        if (!token){\n            dispatch(logout())\n        } else {\n            dispatch(authSuccess(token))\n        }\n    }\n}\n\n\nexport function authSuccess(token) {\n    console.log(\"authSuc\")\n    return {\n        type: AUTH_SUCCESS,\n        token\n    }\n}"]},"metadata":{},"sourceType":"module"}